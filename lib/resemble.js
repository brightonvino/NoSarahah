!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.resemble=t()}(this,function(){"use strict";function e(e,t){return(Math.abs(e.r-t.r)+Math.abs(e.g-t.g)+Math.abs(e.b-t.b))/3}var t=1,r={red:255,green:0,blue:255,alpha:255},n={r:0,g:0,b:0,a:0},i={flat:function(e,t,n,i){e[t]=r.red,e[t+1]=r.green,e[t+2]=r.blue,e[t+3]=r.alpha},movement:function(e,t,n,i){e[t]=(i.r*(r.red/255)+r.red)/2,e[t+1]=(i.g*(r.green/255)+r.green)/2,e[t+2]=(i.b*(r.blue/255)+r.blue)/2,e[t+3]=i.a},flatDifferenceIntensity:function(t,n,i,a){t[n]=r.red,t[n+1]=r.green,t[n+2]=r.blue,t[n+3]=e(i,a)},movementDifferenceIntensity:function(t,n,i,a){var o=e(i,a)/255*.8;t[n]=(1-o)*(a.r*(r.red/255))+o*r.red,t[n+1]=(1-o)*(a.g*(r.green/255))+o*r.green,t[n+2]=(1-o)*(a.b*(r.blue/255))+o*r.blue,t[n+3]=a.a}},a=i.flat,o=1200,h=!0,u="undefined"!=typeof window?window.document:{},f=function(e){function r(){var e,t=N.length;for(e=0;t>e;e++)"function"==typeof N[e]&&N[e](P)}function i(e,t,r){var n,i;for(n=0;e>n;n++)for(i=0;t>i;i++)r(n,i)}function f(e,t,n){var a=0,o=0,h=0,u=0,f=0,s=0,g=0,l=0;i(t,n,function(r,n){var i=4*(n*t+r),d=e[i],m=e[i+1],b=e[i+2],p=e[i+3],v=c(d,m,b);d==m&&d==b&&p&&(0==d?l++:255==d&&g++),a++,o+=d/255*100,h+=m/255*100,u+=b/255*100,f+=(255-p)/255*100,s+=v/255*100}),P.red=Math.floor(o/a),P.green=Math.floor(h/a),P.blue=Math.floor(u/a),P.alpha=Math.floor(f/a),P.brightness=Math.floor(s/a),P.white=Math.floor(g/a*100),P.black=Math.floor(l/a*100),r()}function s(e,t){var r,n=new Image;h&&n.setAttribute("crossorigin","anonymous"),n.onerror=function(){n.onerror=null,R.push({error:"Image load error."}),t()},n.onload=function(){n.onload=null;var e,r=u.createElement("canvas"),i=n.width,a=n.height;L&&1==R.length&&(i=R[0].width,a=R[0].height),r.width=i,r.height=a,r.getContext("2d").drawImage(n,0,0,i,a),e=r.getContext("2d").getImageData(0,0,i,a),R.push(e),t(e,i,a)},"string"==typeof e?(n.src=e,n.complete&&n.naturalWidth>0&&n.onload()):"undefined"!=typeof e.data&&"number"==typeof e.width&&"number"==typeof e.height?(R.push(e),t(e,e.width,e.height)):(r=new FileReader,r.onload=function(e){n.src=e.target.result},r.readAsDataURL(e))}function g(e,t,r){var n=Math.abs(e-t);return"undefined"==typeof e?!1:"undefined"==typeof t?!1:e===t?!0:n<k[r]?!0:!1}function l(e,t){var r=g(e.a,t.a,"alpha"),n=g(e.brightness,t.brightness,"minBrightness");return n&&r}function c(e,t,r){return.3*e+.59*t+.11*r}function d(e,t){var r=e.r===t.r,n=e.g===t.g,i=e.b===t.b;return r&&n&&i}function m(e,t){var r=g(e.r,t.r,"red"),n=g(e.g,t.g,"green"),i=g(e.b,t.b,"blue"),a=g(e.a,t.a,"alpha");return r&&n&&i&&a}function b(e,t){return Math.abs(e.brightness-t.brightness)>k.maxBrightness}function p(e,t,r){e/=255,t/=255,r/=255;var n,i,a=Math.max(e,t,r),o=Math.min(e,t,r);if(a==o)n=0;else{switch(i=a-o,a){case e:n=(t-r)/i+(r>t?6:0);break;case t:n=(r-e)/i+2;break;case r:n=(e-t)/i+4}n/=6}return n}function v(e,t,r,i,a,o){var h,u,f,s=1,g=0,l=0,c=0;for(D(e),u=-1*s;s>=u;u++)for(f=-1*s;s>=f;f++)if(0===u&&0===f);else{if(h=4*((i+f)*o+(a+u)),!y(n,t,h,r))continue;if(M(n),D(n),b(e,n)&&g++,d(e,n)&&c++,Math.abs(n.h-e.h)>.3&&l++,l>1||g>1)return!0}return 2>c?!0:!1}function w(e,r,n){e[r]=n.r,e[r+1]=n.g,e[r+2]=n.b,e[r+3]=n.a*t}function x(e,r,n){e[r]=n.brightness,e[r+1]=n.brightness,e[r+2]=n.brightness,e[r+3]=n.a*t}function y(e,t,r,n){return t.length>r?(e.r=t[r],e.g=t[r+1],e.b=t[r+2],e.a=t[r+3],!0):!1}function M(e){e.brightness=c(e.r,e.g,e.b)}function D(e){e.h=p(e.r,e.g,e.b)}function B(e,t,r,n){var h=u.createElement("canvas"),f=e.data,s=t.data;h.width=r,h.height=n;var g,c=h.getContext("2d"),d=c.createImageData(r,n),b=d.data,p=0,D={top:n,left:r,bottom:0,right:0},B=function(e,t){D.left=Math.min(e,D.left),D.right=Math.max(e,D.right),D.top=Math.min(t,D.top),D.bottom=Math.max(t,D.bottom)},I=Date.now();o&&A&&(r>o||n>o)&&(g=6);var T={r:0,g:0,b:0,a:0},S={r:0,g:0,b:0,a:0};i(r,n,function(e,t){if(!g||t%g!==0&&e%g!==0){var n=4*(t*r+e);if(y(T,f,n,1)&&y(S,s,n,2))return E?(M(T),M(S),void(l(T,S)?x(b,n,S):(a(b,n,T,S),p++,B(e,t)))):void(m(T,S)?w(b,n,T,S):A&&(M(T),M(S),v(T,f,1,t,e,r)||v(S,s,2,t,e,r))&&l(T,S)?x(b,n,S):(a(b,n,T,S),p++,B(e,t)))}}),P.rawMisMatchPercentage=p/(n*r)*100,P.misMatchPercentage=P.rawMisMatchPercentage.toFixed(2),P.diffBounds=D,P.analysisTime=Date.now()-I,P.getImageDataUrl=function(e){var t=0;return e&&(t=C(e,c,h)),c.putImageData(d,0,t),h.toDataURL("image/png")}}function C(e,t,r){var n=2;t.font="12px sans-serif";var i=t.measureText(e).width+2*n,a=22;return i>r.width&&(r.width=i),r.height+=a,t.fillStyle="#666",t.fillRect(0,0,r.width,a-4),t.fillStyle="#fff",t.fillRect(0,a-4,r.width,4),t.fillStyle="#fff",t.textBaseline="top",t.font="12px sans-serif",t.fillText(e,n,1),a}function I(e,t,r){var n,i;return e.height<r||e.width<t?(n=u.createElement("canvas"),n.width=t,n.height=r,i=n.getContext("2d"),i.putImageData(e,0,0),i.getImageData(0,0,t,r)):e}function T(e,t){function n(){var e,t;if(2===R.length){if(R[0].error||R[1].error)return P={},P.error=R[0].error?R[0].error:R[1].error,void r();e=R[0].width>R[1].width?R[0].width:R[1].width,t=R[0].height>R[1].height?R[0].height:R[1].height,R[0].width===R[1].width&&R[0].height===R[1].height?P.isSameDimensions=!0:P.isSameDimensions=!1,P.dimensionDifference={width:R[0].width-R[1].width,height:R[0].height-R[1].height},B(I(R[0],e,t),I(R[1],e,t),e,t),r()}}R=[],s(e,n),s(t,n)}function S(t){var r,n="function"==typeof t;n||(r=t);var i={scaleToSameSize:function(){return L=!0,n&&t(),i},useOriginalSize:function(){return L=!1,n&&t(),i},ignoreNothing:function(){return k.red=0,k.green=0,k.blue=0,k.alpha=0,k.minBrightness=0,k.maxBrightness=255,A=!1,E=!1,n&&t(),i},ignoreLess:function(){return k.red=16,k.green=16,k.blue=16,k.alpha=16,k.minBrightness=16,k.maxBrightness=240,A=!1,E=!1,n&&t(),i},ignoreAntialiasing:function(){return k.red=32,k.green=32,k.blue=32,k.alpha=32,k.minBrightness=64,k.maxBrightness=96,A=!0,E=!1,n&&t(),i},ignoreColors:function(){return k.alpha=16,k.minBrightness=16,k.maxBrightness=240,A=!1,E=!0,n&&t(),i},repaint:function(){return n&&t(),i},onComplete:function(t){N.push(t);var n=function(){T(e,r)};return n(),S(n)}};return i}var P={},R=[],N=[],k={red:16,green:16,blue:16,alpha:16,minBrightness:16,maxBrightness:240},A=!1,E=!1,L=!1;return{onComplete:function(t){N.push(t),s(e,function(e,t,r){f(e.data,t,r)})},compareTo:function(e){return S(e)}}};return f.outputSettings=function(e){var n,u;if(e.errorColor)for(n in e.errorColor)r[n]=e.errorColor[n]===u?r[n]:e.errorColor[n];return e.errorType&&i[e.errorType]&&(a=i[e.errorType]),e.errorPixel&&"function"==typeof e.errorPixel&&(a=e.errorPixel),t=isNaN(Number(e.transparency))?t:e.transparency,e.largeImageThreshold!==u&&(o=e.largeImageThreshold),e.useCrossOrigin!==u&&(h=e.useCrossOrigin),this},f});